(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function e(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=e(a);fetch(a.href,s)}})();class r{constructor(t,e){this.handleInit=t,this.handleGameState=e,this.ws=null,window.addEventListener("beforeunload",()=>{this.ws&&this.ws.close()})}connect(t){this.ws=new WebSocket("ws://praven.kro.kr:5000"),this.ws.onopen=()=>{this.ws.send(JSON.stringify({type:"join",nickname:t}))},this.ws.onmessage=e=>{const i=JSON.parse(e.data);switch(i.type){case"init":this.playerId=i.id,this.handleInit(i);break;case"gameState":this.handleGameState(i);break}}}sendMove(t){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify({id:this.playerId,type:"move",x:t.x,y:t.y}))}}class c{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.scale=1,this.setupCanvas(),this.setupZoom()}setupCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,window.addEventListener("resize",()=>{this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight})}setupZoom(){this.canvas.addEventListener("wheel",t=>{t.preventDefault();const e=-t.deltaY*.001;this.scale=Math.min(Math.max(.5,this.scale+e),2)})}drawMap(t,e){const i=this.canvas.width/2,a=this.canvas.height/2;this.ctx.save(),this.ctx.scale(this.scale,this.scale);const s=(0-e.x)*this.scale+i,n=(0-e.y)*this.scale+a;this.ctx.fillStyle="#1a1a1a",this.ctx.fillRect(s/this.scale,n/this.scale,t.width,t.height),this.ctx.strokeStyle="#2a2a2a",this.ctx.lineWidth=1;for(let h=0;h<=t.width;h+=50)this.ctx.beginPath(),this.ctx.moveTo(s/this.scale+h,n/this.scale),this.ctx.lineTo(s/this.scale+h,n/this.scale+t.height),this.ctx.stroke();for(let h=0;h<=t.height;h+=50)this.ctx.beginPath(),this.ctx.moveTo(s/this.scale,n/this.scale+h),this.ctx.lineTo(s/this.scale+t.width,n/this.scale+h),this.ctx.stroke();this.ctx.strokeStyle="#3498db",this.ctx.lineWidth=2,this.ctx.strokeRect(s/this.scale,n/this.scale,t.width,t.height),this.ctx.restore()}drawPlayer(t,e){const i=this.canvas.width/2,a=this.canvas.height/2,s=(t.x-e.x)*this.scale+i,n=(t.y-e.y)*this.scale+a;this.ctx.save(),this.ctx.scale(this.scale,this.scale),this.ctx.beginPath(),this.ctx.arc(s/this.scale,n/this.scale,20,0,Math.PI*2),this.ctx.fillStyle=t.color||"#ff0000",this.ctx.fill(),this.ctx.closePath(),this.ctx.font="16px Arial",this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.fillText(t.name,s/this.scale,n/this.scale-30),this.ctx.restore()}clear(){this.ctx.fillStyle="#000000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}}class l{constructor(t){this.onLogin=t,this.element=document.getElementById("nicknameModal"),this.setupModal()}setupModal(){const t=this.element.querySelector("#nicknameInput"),e=this.element.querySelector("#startButton");e.onclick=()=>{const i=t.value.trim();i&&(this.element.style.display="none",this.onLogin(i))}}}class d{constructor(t){this.game=t,this.movement={up:!1,down:!1,left:!1,right:!1},this.moveSpeed=5,this.setupControls()}setupControls(){document.addEventListener("keydown",t=>{switch(t.key.toLowerCase()){case"w":this.movement.up=!0;break;case"s":this.movement.down=!0;break;case"a":this.movement.left=!0;break;case"d":this.movement.right=!0;break}}),document.addEventListener("keyup",t=>{switch(t.key.toLowerCase()){case"w":this.movement.up=!1;break;case"s":this.movement.down=!1;break;case"a":this.movement.left=!1;break;case"d":this.movement.right=!1;break}})}update(){let t=0,e=0;if(this.movement.up&&(e-=1),this.movement.down&&(e+=1),this.movement.left&&(t-=1),this.movement.right&&(t+=1),t!==0&&e!==0){const i=Math.sqrt(t*t+e*e);t=t/i,e=e/i}if(t!==0||e!==0){const i=this.game.players.get(this.game.playerId);if(!i)return;const a=i.x+t*this.moveSpeed,s=i.y+e*this.moveSpeed;a>=0&&a<=this.game.mapSize.width&&s>=0&&s<=this.game.mapSize.height&&this.sendPositionToServer(a,s)}}sendPositionToServer(t,e){(!this.lastSentTime||Date.now()-this.lastSentTime>=16)&&(this.game.networkManager.sendMove({x:t,y:e}),this.lastSentTime=Date.now())}}class m{constructor(){this.renderer=new c(document.getElementById("gameCanvas")),this.networkManager=new r(this.handleInit.bind(this),this.handleGameState.bind(this)),this.loginModal=new l(this.handleLogin.bind(this)),document.body.appendChild(this.loginModal.element),this.players=new Map,this.playerId=null,this.mapSize={width:0,height:0},this.playerController=new d(this)}handleInit(t){this.playerId=t.id,this.mapSize=t.mapSize,this.updatePlayers(t.gameState.players),this.startGameLoop()}handleGameState(t){this.updatePlayers(t.players)}handleLogin(t){this.networkManager.connect(t)}updatePlayers(t){this.players.clear(),t.forEach(e=>{this.players.set(e.id,e)})}startGameLoop(){const t=()=>{this.playerController.update(),this.renderer.clear();const e=this.players.get(this.playerId);e&&(this.renderer.drawMap(this.mapSize,e),this.players.forEach(i=>{this.renderer.drawPlayer(i,e)})),requestAnimationFrame(t)};t()}}new m;
